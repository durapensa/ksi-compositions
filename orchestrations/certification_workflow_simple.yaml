name: certification_workflow_simple
version: 1.0.0
description: Simple certification workflow for component updates
transformers:
  # Trigger certification when components are created
  - source: composition:create_component
    target: certification:request
    mapping:
      name: data.name
      component_type: data.component_type  
    enabled: true
    
  # Trigger certification when components are updated
  - source: composition:update_component
    target: certification:request
    mapping:
      name: data.name
      component_type: data.component_type
    enabled: true
    
  # Run evaluation when certification is requested
  - source: certification:request
    target: evaluation:run
    mapping:
      component_path: data.name
      test_suite: |
        {
          "persona": "persona_effectiveness",
          "behavior": "behavior_certification", 
          "core": "core_functionality",
          "workflow": "workflow_orchestration",
          "tool": "tool_integration",
          "evaluation": "evaluation_accuracy"
        }.get(data.get("component_type", "persona"), "basic_effectiveness")
      model: "claude-cli/sonnet"
    enabled: true
    
  # Process evaluation results
  - source: evaluation:complete
    target: certification:complete
    condition: data.get("certification_mode") == True
    mapping:
      component_path: data.component_path
      status: |
        score = data.get("score", 0)
        if score >= 0.90:
          "certified"
        elif score >= 0.85:
          "provisional"
        elif score >= 0.75:
          "provisional"  
        else:
          "uncertified"
      certificate_id: data.certificate_id
      score: data.score
    enabled: true
    
  # Update component metadata with certification
  - source: certification:complete
    target: composition:update_metadata
    mapping:
      component_path: data.component_path
      metadata:
        certification:
          status: data.status
          certificate_id: data.certificate_id
          score: data.score
          model: "claude-cli/sonnet"
    enabled: true
    
  # Log certification status
  - source: certification:complete
    target: monitor:log
    mapping:
      level: |
        "info" if data.get("status") == "certified" else "warning"
      message: |
        f"Component {data.get('component_path')} certification: {data.get('status')} (score: {data.get('score')})"
      component: data.component_path
      certificate_id: data.certificate_id
    enabled: true